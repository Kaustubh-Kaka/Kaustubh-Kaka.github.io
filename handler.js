let contentID = "TRS";

let trsData = [
  {
    name: "Shreyas Anand",
    year: 1,
    department: "EE",
    hall: "LBS",
    img_src: "shreyas_anand.png",
  },
  {
    name: "Vijeta V Menon",
    year: 1,
    department: "CH",
    hall: "SNVH",
    img_src: "vijeta_v_menon.png",
  },
  {
    name: "Rupesh Devata",
    year: 1,
    department: "MF",
    hall: "LBS",
    img_src: "rupesh_devata.png",
  },
  {
    name: "Siddhant Barpanda",
    year: 1,
    department: "HS",
    hall: "LBS",
    img_src: "siddhant_barpanda.png",
  },
  {
    name: "Ayush Bhushan",
    year: 1,
    department: "EE",
    hall: "LBS",
    img_src: "ayush_bhushan.png",
  },
  {
    name: "Vinay A",
    year: 1,
    department: "EE",
    hall: "LBS",
    img_src: "vinay_a.png",
  },
  {
    name: "Siddharth Jain",
    year: 1,
    department: "MT",
    hall: "LBS",
    img_src: "siddharth_jain.png",
  },
  {
    name: "Vrinda Singh",
    year: 1,
    department: "MI",
    hall: "SNVH",
    img_src: "vrinda_singh.png",
  },
  {
    name: "Uddipto Mandal",
    year: 1,
    department: "IM",
    hall: "LBS",
    img_src: "uddipto_mandal.png",
  },
  {
    name: "Md Musheer Khan",
    year: 1,
    department: "MT",
    hall: "LBS",
    img_src: "md_musheer_khan.png",
  },
  {
    name: "Prakhar Jha",
    year: 1,
    department: "IE",
    hall: "LBS",
    img_src: "prakhar_jha.png",
  },
  {
    name: "Prateek Kesavarapu",
    year: 1,
    department: "NA",
    hall: "LBS",
    img_src: "prateek_kesavarapu.png",
  },
  {
    name: "Adya Singh",
    year: 1,
    department: "AE",
    hall: "SNVH",
    img_src: "adya_singh.png",
  },
  {
    name: "Sujal Singh",
    year: 1,
    department: "ME",
    hall: "LBS",
    img_src: "sujal_singh.png",
  },
  {
    name: "Sohan Choudhury",
    year: 1,
    department: "EC",
    hall: "LBS",
    img_src: "sohan_choudhury.png",
  },
  {
    name: "Kaustubh Kaka",
    year: 1,
    department: "MA",
    hall: "LBS",
    img_src: "kaustubh_kaka.png",
  },
  {
    name: "Siddharth Sreejith",
    year: 1,
    department: "EC",
    hall: "LBS",
    img_src: "siddharth_sreejith.png",
  },
  {
    name: "Raghav Pande",
    year: 1,
    department: "IE",
    hall: "LBS",
    img_src: "raghav_pande.png",
  },
  {
    name: "Praneet Dixit",
    year: 1,
    department: "ME",
    hall: "LBS",
    img_src: "praneet_dixit.png",
  },
  {
    name: "Durva Daga",
    year: 1,
    department: "AI",
    hall: "SNVH",
    img_src: "durva_daga.png",
  },
  {
    name: "Allu Gowri Sasaank",
    year: 1,
    department: "CS",
    hall: "LBS",
    img_src: "allu_gowri_sasaank.png",
  },
  {
    name: "Parth Raut",
    year: 1,
    department: "ME",
    hall: "LBS",
    img_src: "parth_raut.png",
  },
  {
    name: "Aditya Gupta",
    year: 2,
    department: "ME",
    hall: "HJB",
    img_src: "aditya_gupta.png",
  },
  {
    name: "Anjali Deepu",
    year: 2,
    department: "NA",
    hall: "MT",
    img_src: "anjali_deepu.png",
  },
  {
    name: "Dhruv Mathur",
    year: 2,
    department: "IM",
    hall: "Patel",
    img_src: "dhruv_mathur.png",
  },
  {
    name: "Divyanshi Narware",
    year: 2,
    department: "ME",
    hall: "MT",
    img_src: "divyanshi_narware.png",
  },
  {
    name: "Ishan Phanse",
    year: 2,
    department: "AE",
    hall: "Azad",
    img_src: "ishan_phanse.png",
  },
  {
    name: "Jash Mehta",
    year: 2,
    department: "IM",
    hall: "MMM",
    img_src: "jash_mehta.png",
  },
  {
    name: "John Felix",
    year: 2,
    department: "IM",
    hall: "RP",
    img_src: "john_felix.png",
  },
  {
    name: "Manish Kundu",
    year: 2,
    department: "MA",
    hall: "RK",
    img_src: "manish_kundu.png",
  },
  {
    name: "Rishith Susarla",
    year: 2,
    department: "EC",
    hall: "VS",
    img_src: "rishith_susarla.png",
  },
  {
    name: "Samarth G",
    year: 2,
    department: "EC",
    hall: "Azad",
    img_src: "samarth_g.png",
  },
  {
    name: "Shrreya Rajneesh",
    year: 2,
    department: "AE",
    hall: "SNVH",
    img_src: "shrreya_rajneesh.png",
  },
  {
    name: "Divyansh Sharma",
    year: 3,
    department: "GG",
    hall: "RP",
    img_src: "divyansh_sharma.png",
  },
  {
    name: "Meera Nair",
    year: 3,
    department: "ME",
    hall: "MT",
    img_src: "meera_nair.png",
  },
  {
    name: "Muskan Khemka",
    year: 3,
    department: "GG",
    hall: "SN/IG",
    img_src: "muskan_khemka.png",
  },
  {
    name: "Parag Agarwal",
    year: 3,
    department: "IM",
    hall: "MMM",
    img_src: "parag_agarwal.png",
  },
  {
    name: "Prakhar Tripathi",
    year: 3,
    department: "MI",
    hall: "RP",
    img_src: "prakhar_tripathi.png",
  },
  {
    name: "Pranav Mangal Pandey",
    year: 3,
    department: "CE",
    hall: "MMM",
    img_src: "pranav_mangal_pandey.png",
  },
  {
    name: "Swaminathan S K",
    year: 3,
    department: "CS",
    hall: "HJB",
    img_src: "swaminathan_sk.png",
  },
  {
    name: "U Skanda Aithal",
    year: 3,
    department: "EC",
    hall: "Azad",
    img_src: "u_skanda_aithal.png",
  },
  {
    name: "Abhinav Viju Pillai",
    year: 4,
    department: "ME",
    hall: "RK",
    img_src: "abhinav_viju_pillai.png",
  },
  {
    name: "Aditya Nandy",
    year: 4,
    department: "EE",
    hall: "Patel",
    img_src: "aditya_nandy.png",
  },
  {
    name: "Akshay S Menon",
    year: 4,
    department: "EE",
    hall: "MMM",
    img_src: "akshay_s_menon.png",
  },
  {
    name: "Amrit Lal Singh",
    year: 4,
    department: "IM",
    hall: "LBS",
    img_src: "amrit_lal_singh.png",
  },
  {
    name: "Parth Gupta",
    year: 4,
    department: "BT",
    hall: "Patel",
    img_src: "parth_gupta.png",
  },
  {
    name: "Parthivi Gupta",
    year: 4,
    department: "AE",
    hall: "SNVH",
    img_src: "parthivi_gupta.png",
  },
  {
    name: "Prasanna Paithankar",
    year: 4,
    department: "CS",
    hall: "Azad",
    img_src: "prasanna_paithankar.png",
  },
  {
    name: "Siddharth Asthana",
    year: 4,
    department: "MI",
    hall: "RK",
    img_src: "siddharth_asthana.png",
  },
  {
    name: "Tanushree Prasad",
    year: 4,
    department: "ME",
    hall: "MT",
    img_src: "tanushree_prasad.png",
  },
  {
    name: "Vivek Mirani",
    year: 4,
    department: "ME",
    hall: "RP",
    img_src: "vivek_mirani.png",
  },
  {
    name: "Harmeet singh",
    year: 5,
    department: "CY",
    hall: "Azad",
    img_src: "harmeet_singh.png",
  },
  {
    name: "Yashi Gaur",
    year: 5,
    department: "ME",
    hall: "SN/IG",
    img_src: "yashi_gaur.png",
  },
];

let toggleState = Array(trsData.length).fill(true);

let yearState = [false, false, true, true, true];

function yearToRole(n) {
  if (n == 1) return "Member";
  else if (n == 2) return "Sub-Head";
  else if (n == 3) return "Head";
  else return "Coordinator";
}

function cardHTML(obj, hideData = false, ind) {
  if (yearState[obj.year - 1])
    return `
        <div class="namecard" data-num="${ind}">
          <div class="Image-wrapper"><img src="./TRSpics/${
            obj.img_src
          }" style="max-width:180px; max-height:180px; object-fit: contain;"></div>
          <p class="Name">${obj.name}</p>
          <p class="Hall">${obj.hall}</p>
          <p class="Department">${obj.department}</p>
          <p class="Role">${yearToRole(obj.year)}</p>
        </div>
      `;
  else return "";
}

function renderAll() {
  let s = "";
  s += `<div id="card-wrapper">`;
  for (let i = 0; i < trsData.length; i++) {
    if (i && trsData[i].year != trsData[i - 1].year)
      s += `</div><div id="card-wrapper">`;
    s += cardHTML(trsData[i], !toggleState[i], i);
  }
  s += `</div>`;
  document.querySelector("#content-area").innerHTML = s;
}

function renderMainContent() {
  if (contentID == "animation") {
    document.querySelector("#content-area").innerHTML = document.querySelector(
      "#animation-content"
    ).innerHTML;

    canvas = document.querySelector("#mycanvas");
    ctx = canvas.getContext("2d");

    canvas.width = window.innerWidth;
    canvas.height = window.innerHeight;

    let disabled = false;
    let sliderEnable = false;
    let isUpdating = true;
    let eccentricityScale = 0.6;
    let prop = 0.001;
    let eccentricity = 0.6;
    let origin = [canvas.width / 2, canvas.height / 2];
    let eotPoints = [];
    let eotGraphOrigin = [40, 650];
    let eotGraphScale = [0.06, 90];
    ctx.strokeStyle = "#fff";
    ctx.fillStyle = "#fff";

    let roundN = function(x, n) {
      return Math.round(x * 10 ** n) / 10 ** n;
    };

    let drawReference = function() {
      ctx.strokeStyle = "#fff";
      ctx.lineWidth = 1;
      ctx.setLineDash([5, 5]);

      ctx.beginPath();
      ctx.moveTo(0, origin[1]);
      ctx.lineTo(2 * origin[0], origin[1]);
      ctx.stroke();
      ctx.setLineDash([]);
    };

    let drawText = function(inputText, distanceFromTop) {
      ctx.fillStyle = "#fff";
      ctx.font = "25px Arial";
      ctx.fillText(inputText, 10, distanceFromTop);
    };

    let clamp = function(x, a, b) {
      if (x < a) return a;
      else if (x > b) return b;
      else return x;
    };

    let drawEOTGraph = function() {
      console.log("working");
      ctx.beginPath();
      ctx.strokeStyle = "#fff";
      ctx.setLineDash([]);
      for (let i = 0; i < eotPoints.length - 1; i++) {
        ctx.moveTo(
          eotGraphOrigin[0] + eotGraphScale[0] * eotPoints[i][0],
          eotGraphOrigin[1] - eotGraphScale[1] * eotPoints[i][1]
        );
        ctx.lineTo(
          eotGraphOrigin[0] + eotGraphScale[0] * eotPoints[i + 1][0],
          eotGraphOrigin[1] - eotGraphScale[1] * eotPoints[i + 1][1]
        );
      }
      ctx.stroke();
    };

    class orbit {
      constructor(a, epsilon, lineStyle = []) {
        this.a = a;
        this.epsilon = epsilon;
        this.lineStyle = lineStyle;
      }

      draw() {
        ctx.strokeStyle = "#fff";
        ctx.lineWidth = 2;
        ctx.setLineDash(this.lineStyle);
        ctx.beginPath();

        ctx.ellipse(
          origin[0] + this.a * this.epsilon,
          origin[1],
          this.a,
          this.a * Math.pow(1 - this.epsilon ** 2, 0.5),
          0,
          0,
          2 * Math.PI
        );
        ctx.stroke();
        ctx.setLineDash([]);
      }
    }

    class circularBody {
      constructor(
        a,
        epsilon,
        theta,
        argumentOfPeriapsis = 0,
        orbitalInclination = 0,
        radius,
        color = "#fff"
      ) {
        this.a = a;
        this.T = 1.00000250961 * Math.pow(a, 1.5);
        this.epsilon = epsilon;
        this.theta = theta;
        this.argumentOfPeriapsis = argumentOfPeriapsis;
        this.orbitalInclination = orbitalInclination;
        this.radius = radius;
        this.color = color;
        this.updateN = 0;
        this.idealOrbit = new orbit(this.a, 0, [5, 5]);
        this.bodyOrbit = new orbit(this.a, this.epsilon);
      }

      draw() {
        ctx.fillStyle = this.color;
        ctx.strokeStyle = this.color;
        ctx.lineWidth = 1;

        let r =
          (this.a * (1 - this.epsilon ** 2)) /
          (1 - this.epsilon * Math.cos(this.theta));
        ctx.beginPath();
        ctx.arc(
          origin[0] + r * Math.cos(this.theta),
          origin[1] - r * Math.sin(this.theta),
          this.radius,
          0,
          2 * Math.PI
        );
        ctx.stroke();
        ctx.fill();
      }

      drawImage() {
        ctx.strokeStyle = this.color;
        ctx.fillStyle = "rgba(0,0,0,0.5)";
        ctx.lineWidth = 2;

        let r = this.a;
        ctx.beginPath();
        ctx.arc(
          origin[0] + r * Math.cos(this.theta),
          origin[1] - r * Math.sin(this.theta),
          this.radius,
          0,
          2 * Math.PI
        );
        ctx.stroke();
        ctx.fill();
      }

      drawIdealOrbit() {
        this.idealOrbit.draw();
      }

      drawBodyOrbit() {
        this.bodyOrbit.draw();
      }

      drawIdeal() {
        ctx.beginPath();
        ctx.strokeStyle = "#f00";
        ctx.fillStyle = "#f00";
        ctx.arc(
          origin[0] + this.a * Math.cos(2 * Math.PI * this.updateN * prop),
          origin[1] - this.a * Math.sin(2 * Math.PI * this.updateN * prop),
          this.radius,
          0,
          2 * Math.PI
        );
        ctx.stroke();
        ctx.fill();
      }

      drawRay() {
        ctx.strokeStyle = "#fff";
        ctx.lineWidth = 2;

        let r = Math.max(
          (this.a * (1 - this.epsilon ** 2)) /
            (1 - this.epsilon * Math.cos(this.theta)),
          this.a
        );
        ctx.beginPath();
        ctx.moveTo(origin[0], origin[1]);
        ctx.lineTo(
          origin[0] + r * Math.cos(this.theta),
          origin[1] - r * Math.sin(this.theta)
        );
        ctx.stroke();
      }

      updatePhysicallyCorrect(internalUpdate = false) {
        if (!internalUpdate) this.updateN += 1;
        this.updateN %= parseInt(1 / prop);

        let omegaAtApoapsis =
          2 *
          Math.PI *
          0.9999974904 *
          Math.pow(
            (1 - this.epsilon) / (this.a * (1 + this.epsilon)) ** 3,
            0.5
          );
        let curOmega =
          omegaAtApoapsis *
          ((1 - this.epsilon * Math.cos(this.theta)) / (1 - this.epsilon)) ** 2;

        this.theta += curOmega * prop * this.T;
        while (this.theta > 2 * Math.PI) this.theta -= 2 * Math.PI;

        let equationOfTime = this.theta - 2 * this.updateN * prop * Math.PI;
        if (eotPoints.length < parseInt(1 / prop) - 1)
          eotPoints.push([this.updateN * prop * this.T, equationOfTime]);

        drawText(
          "Equation of time: " + roundN((180 * equationOfTime) / Math.PI, 3),
          40
        );
      }

      recompute() {
        if (this.updateN > parseInt(1 / prop) / 2) {
          this.theta = Math.PI;
          for (let i = 500; i < this.updateN; i++)
            this.updatePhysicallyCorrect(true);
        } else {
          this.theta = 0;
          for (let i = 0; i < this.updateN; i++)
            this.updatePhysicallyCorrect(true);
        }
      }
    }

    let p2 = new circularBody(350, eccentricity, 0, 0, 0, 10, "#0f0");

    let star = new circularBody(0, 0, 0, 0, 0, 30, "#ff0");

    document
      .querySelector("#guide-toggle-check")
      .addEventListener("click", function(e) {
        disabled = !this.checked;
      });

    document.querySelector("#slider").style.left =
      (eccentricity * 200) / eccentricityScale - 10;

    document
      .querySelector("#slider")
      .addEventListener("mousedown", function(e) {
        e.preventDefault();
        sliderEnable = true;
      });

    document.querySelector("body").addEventListener("mousemove", function(e) {
      e.preventDefault();
      if (sliderEnable) {
        let eslider = document.querySelector("#slider");
        eslider.style.left = clamp(e.x - 30, -10, 190);
        eccentricity =
          (eccentricityScale * (parseFloat(eslider.style.left) + 10)) / 200;
        p2.bodyOrbit.epsilon = eccentricity;
        p2.epsilon = eccentricity;
        p2.recompute();
      }
    });

    document.querySelector("body").addEventListener("mouseup", function(e) {
      e.preventDefault();
      sliderEnable = false;
    });

    document
      .querySelector("#animation-toggle")
      .addEventListener("click", function(e) {
        e.preventDefault();
        isUpdating = !isUpdating;
        if (isUpdating) this.innerHTML = "Pause";
        else this.innerHTML = "Play";
      });

    document
      .querySelector("#sliding-bar")
      .addEventListener("click", function(e) {
        e.preventDefault();
        document.querySelector("#slider").style.left = e.x - 30;
        eccentricity = (eccentricityScale * (parseFloat(e.x - 30) + 10)) / 200;
        p2.bodyOrbit.epsilon = eccentricity;
        p2.epsilon = eccentricity;
        p2.recompute();
      });

    let animate = function() {
      //ctx.fillStyle = "rgba(0,0,0,0.1)";
      ctx.clearRect(0, 0, canvas.width, canvas.height);
      drawReference();
      drawEOTGraph();
      p2.drawBodyOrbit();
      if (!disabled) {
        p2.drawIdealOrbit();
        //p2.drawRay();
        p2.drawImage();
      }

      star.draw();
      p2.draw();
      p2.drawIdeal();
      if (isUpdating) {
        p2.updatePhysicallyCorrect();
      }
      drawText("Eccentricity: " + roundN(eccentricity, 3), 75);

      requestAnimationFrame(animate);
    };

    animate();
  } else if (contentID == "logo") {
    document.querySelector("#content-area").innerHTML = `
      <h1>Hello I am Kaustubh kaka</h1>
    `;
  } else if (contentID == "blog") {
    document.querySelector("#content-area").innerHTML = ``;
  } else if (contentID == "TRS") {
    // card rendering logic
    renderAll();
    document.querySelector(".namecard").addEventListener("click", function(e) {
      e.preventDefault();
      console.log(e);
      toggleState[e.currentTarget.dataset.num] = !toggleState[
        e.currentTarget.dataset.num
      ];
      renderAll();
    });
  }
}

renderMainContent();

let navitem = document.querySelectorAll(".navitem");

for (let i = 0; i < navitem.length; i++) {
  navitem[i].addEventListener("click", function(e) {
    e.preventDefault();
    contentID = navitem[i].dataset.content;
    renderMainContent();
  });
}
